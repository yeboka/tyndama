<!doctype html>
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tyndama</title>
    <link rel="stylesheet" href="{% static 'tyndama/css/styles.css' %}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"
          integrity="sha512-HK5fgLBL+xu6dm/Ii3z4xhlSUyZgTT9tuc/hSrtw6uzJOvgRr2a9jyxxT1ely+B+xFAmJKVSTbpM/CuL7qxO8w=="
          crossorigin="anonymous"/>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Chivo:ital,wght@0,200;0,300;0,400;0,500;0,600;1,200&family=M+PLUS+1:wght@100;200;300;400;500;600;700;800&display=swap"
          rel="stylesheet">
</head>
<body>
<audio src="" id="audio"></audio>
<div class="nav">
    <div class="info">
        <div class="profile-info">
            <div class="avatar" style="background-image: url('{% static 'tyndama/img/g9DlTPEgG_s.jpg' %}');"></div>
            <h4 class="name">Yerbolat</h4>
        </div>
        <div class="buttons">
            <a href="">
                <img src="{% static 'tyndama/img/profile.svg' %}" alt="">
                <span>Profile</span>
            </a>
            <a href="">
                <img src="{% static 'tyndama/img/logout.svg' %}" alt="">
                <span>Log Out</span>
            </a>
        </div>
    </div>
    <div class="playlists">
        <h4>Your Playlists</h4>
        <div class="playlist">
            <div class="img-wrapper" style="background-image: url('{% static 'tyndama/img/img.png' %}')"></div>
            <div class="playlist-info">
                <p class="title">All Songs</p>
                <p class="num-of-tracks">121 tracks</p>
            </div>
        </div>
        <div class="playlist">
            <div class="img-wrapper" style="background-image: url('{% static 'tyndama/img/PKQqPbaUp6s.jpg' %}')"></div>
            <div class="playlist-info">
                <p class="title">Playlist</p>
                <p class="num-of-tracks">121 tracks</p>
            </div>
        </div>
        <div class="playlist">
            <div class="img-wrapper" style="background-image: url('{% static 'tyndama/img/PKQqPbaUp6s.jpg' %}')"></div>
            <div class="playlist-info">
                <p class="title">Playlist</p>
                <p class="num-of-tracks">121 tracks</p>
            </div>
        </div>
    </div>
</div>
<div class="content">
    <div class="top-block">
        <div class="search">
            <form>
                <input type="search" class="search-input" placeholder="Search song name, artist"
                       aria-label="search vault">
                <i class="fas fa-search search-icon" aria-hidden="true"></i>
                <button type="submit" class="search-button">Search</button>
            </form>
        </div>
        <div class="curr-playlist">
            <div class="img-wrapper big"
                 style="background-image: url('{% static 'tyndama/img/PKQqPbaUp6s.jpg' %}')"></div>
            <div class="playlist-info mr">
                <p class="big-title">Playlist</p>
                <p class="big-num-of-tracks">121 tracks</p>
            </div>
        </div>
    </div>
    <div class="mid-block">
        <div class="wrapper-table">
            <table id="playlist" class="no-select">
                <thead>
                <th>#</th>
                <th></th>
                <th>Title</th>
                <th>Artist</th>
                <th>Album</th>
                <th>
                    <img src="{% static 'tyndama/img/clock.svg' %}" alt="time">
                </th>
                </thead>
                <tbody>
                {% for i in music %}
                    <tr>
                        <td>{{ i.song_id }}</td>
                        <td><img src="{% static 'tyndama/img/play.svg' %}" onclick="startPlay('{{ i.song }}')" alt=""></td>
                        <td>{{ i.name }}</td>
                        <td>{{ i.singer }}</td>
                        <td>{{ i.album }}</td>
                        <td>{{ i.time }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <div class="bottom-block">
        <div class="light"></div>
        <div class="player">
{#            style="background-image: url('{% static 'tyndama/img/img_1.png' %}')"#}
            <div class="album-image" ></div>
            <div class="control-panel">
                <p class="player-title" id="player-title">

                </p>
                <p class="artist">

                </p>
                <div class="control">
                    <div class="btn btn-repeat">
                        <i class="fas fa-redo"></i>
                    </div>
                    <div class="btn btn-prev">
                        <i class="fas fa-step-backward"></i>
                    </div>
                    <div class="btn btn-toggle-play">
                        <span></span>
                        <span></span>
                    </div>
                    <div class="btn btn-next">
                        <i class="fas fa-step-forward"></i>
                    </div>
                    <div class="btn btn-random">
                        <i class="fas fa-random"></i>
                    </div>
                </div>
                <div class="seek-bar">
                    <div class="times">
                        <div class="curr-time"></div>
                        <input id="progress" class="progress" type="range" value="0" step="1" min="0" max="100">
                        <div class="duration"></div>
                    </div>
                </div>

            </div>

        </div>
    </div>
</div>
<script>

    const data = [
        {
            name: 'Feel Good Inc',
            path: '/media/{{ music }}',
            artist: 'Gorillaz',
            img: 'https://github.com/yeboka/tyndama/blob/aa7a34a46932070b7264e43f1514c327501be968/media/images_1/beck.jpg'
        }
    ]

    let currentMusic = 0;

    const music = document.getElementById("audio");

    const seek_bar = document.querySelector('.progress');
    const album_img = document.querySelector('.album-image');
    const song_title = document.querySelector('.player-title');
    const artist = document.querySelector('.artist');
    const curr_time = document.querySelector('.curr-time');
    const duration = document.querySelector('.duration');
    const  play_btn = document.querySelector('.btn-toggle-play');
    const forward_btn = document.querySelector('.btn-next');
    const previus_btn = document.querySelector('.btn-prev');

    play_btn.addEventListener('click', () =>{
        play_btn.classList.toggle('pause')
    })

    const setMusic = (i) => {
        seek_bar.value = 0;
        let song = data[i];
        currentMusic = i;

        console.log(song)
        console.log(artist)
        music.src = song.path;
        music.play()
        song_title.innerHTML = song.name;
        artist.innerHTML = song.artist;
        album_img.style.backgroundImage = `url('${song.img}')`;

        curr_time.innerHTML = '00:00'
        setTimeout(()=>{
            seek_bar.max = music.duration;
            duration.innerHTML = formatTime(music.duration);
        }, 500);
    }

    setMusic(0);

    formatTime = (duration) => {
        let min = Math.floor(duration / 60);
        let sec = Math.floor(duration % 60);
        return `${min}:${sec}`;

    }

    function startPlay(song) {
        music.src = `/media/${song}`
        music.play()
        console.log(song)
    }
</script>
</body>
</html>